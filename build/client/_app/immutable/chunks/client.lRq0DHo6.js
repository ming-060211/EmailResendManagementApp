var k=Object.defineProperty;var A=(i,e,t)=>e in i?k(i,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):i[e]=t;var u=(i,e,t)=>(A(i,typeof e!="symbol"?e+"":e,t),t);import{D as w,E as h,C}from"./scheduler.hcFPtB4K.js";import{n as R}from"./stores.64f70fqn.js";import{w as T,b as x,c as b}from"./entry.9FwAuDwT.js";const F=encodeURIComponent,l=/^[\u0009\u0020-\u007e\u0080-\u00ff]+$/;function M(i,e,t){let s=t||{},o=s.encode||F;if(typeof o!="function")throw new TypeError("option encode is invalid");if(!l.test(i))throw new TypeError("argument name is invalid");let r=o(e);if(r&&!l.test(r))throw new TypeError("argument val is invalid");let a=i+"="+r;if(s.maxAge!=null){let n=s.maxAge-0;if(isNaN(n)||!isFinite(n))throw new TypeError("option maxAge is invalid");a+="; Max-Age="+Math.floor(n)}if(s.domain){if(!l.test(s.domain))throw new TypeError("option domain is invalid");a+="; Domain="+s.domain}if(s.path){if(!l.test(s.path))throw new TypeError("option path is invalid");a+="; Path="+s.path}if(s.expires){if(typeof s.expires.toUTCString!="function")throw new TypeError("option expires is invalid");a+="; Expires="+s.expires.toUTCString()}if(s.httpOnly&&(a+="; HttpOnly"),s.secure&&(a+="; Secure"),s.sameSite)switch(typeof s.sameSite=="string"?s.sameSite.toLowerCase():s.sameSite){case!0:a+="; SameSite=Strict";break;case"lax":a+="; SameSite=Lax";break;case"strict":a+="; SameSite=Strict";break;case"none":a+="; SameSite=None";break;default:throw new TypeError("option sameSite is invalid")}return a}const _={clearArray:!1,clearOnNavigate:!0,clearAfterMs:0,flashCookieOptions:{path:"/",maxAge:120,httpOnly:!1,sameSite:"strict"}};function O(i,e){return{...i,...e,flashCookieOptions:{...i.flashCookieOptions,...e==null?void 0:e.flashCookieOptions}}}class y{constructor(e,t){u(this,"options");u(this,"_message");u(this,"_flashTimeout",0);this.options=t??_,this._message={subscribe:e.subscribe,set:(s,o)=>e.update(r=>this.update(r,s,(o==null?void 0:o.concatenateArray)??!1)),update:(s,o)=>e.update(r=>this.update(r,s(r),(o==null?void 0:o.concatenateArray)??!1))}}get message(){return this._message}get flashTimeout(){return this._flashTimeout}update(e,t,s=!1){return this._flashTimeout&&clearTimeout(this.flashTimeout),s&&Array.isArray(t)&&Array.isArray(e)?e.length>0&&t.length>0&&e[e.length-1]===t[t.length-1]?e:e.concat(t):(t!==void 0&&this.options.clearAfterMs&&(this._flashTimeout=setTimeout(()=>{this.message.set(void 0)},this.options.clearAfterMs)),t)}}class v{constructor(){u(this,"routes",new Map);u(this,"messageStore");this.messageStore=T(),this.routes.set("",new y(this.messageStore)),w(()=>{for(const e of this.routes.values())clearTimeout(e.flashTimeout)})}get defaultRoute(){return this.routes.get("")}has(e){return this.routes.has(e)}getFlashMessage(e){return e?this.routes.has(e)?this.routes.get(e):this.getClosestRoute(e):this.defaultRoute}getClosestRoute(e){const t=Array.from(this.routes.keys()).filter(o=>e.includes(o));if(!t.length)return this.defaultRoute;const s=t.reduce((o,r)=>r.length>o.length?r:o);return this.routes.get(s)}createRoute(e,t,s){const o=this.getClosestRoute(e),r=new y(this.messageStore,O(o.options,s));return r.message.set(t),this.routes.set(e,r),r}}const f="flash",S=new WeakMap;function c(i,e){let t=S.get(i);return t||(t=new v,S.set(i,t),t.getFlashMessage(h(i).route.id).message.set(e),E(i)),t}function E(i){i.subscribe(e=>{const t=d();if(t!==void 0){const s=c(i).getFlashMessage(e.route.id);s.message.set(t,{concatenateArray:!s.options.clearArray}),m(s.options.flashCookieOptions)}}),x(e=>{var s,o;const t=(s=e==null?void 0:e.to)==null?void 0:s.route.id;if(t){const r=c(i).getFlashMessage(t);r.options.clearOnNavigate&&((o=e.from)==null?void 0:o.route.id)!=t&&r.message.set(void 0)}}),b(()=>{const e=d();if(e!==void 0){const t=c(i).getFlashMessage(h(i).route.id);t.message.set(e,{concatenateArray:!t.options.clearArray}),m(t.options.flashCookieOptions)}})}function N(i,e){const t=h(i),s=c(i,t.data.flash);function o(){const p=s.routes.get(g());return p||(e?r():s.getClosestRoute(g()))}function r(){return s.createRoute(g(),n(),e)}const a={store:i,route:t.route.id,initialdata:t.data.flash,navigating:R};function n(){return a.initialdata}function g(){return a.route??""}return o()}function D(i,e){return N(i,e).message}async function H(i,e){e&&await e();const t=d();if(t!==void 0){await C();const s=c(i).getFlashMessage(h(i).route.id);s.message.set(t,{concatenateArray:!s.options.clearArray}),m(s.options.flashCookieOptions)}return!!t}function m(i){document.cookie=M(f,"",{...i,maxAge:0})}function d(){const i=document.cookie;if(!i||!i.includes(f+"="))return;function e(s){const o={};return s?s.split(";").map(r=>r.split("=")).reduce((r,a)=>(r[decodeURIComponent(a[0].trim())]=decodeURIComponent(a[1].trim()),r),o):o}const t=e(i);if(t[f])try{return JSON.parse(t[f])}catch{}}export{D as g,H as u};
